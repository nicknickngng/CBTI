<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBTI - Sleep Fitness</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Initial Prompt Screen -->
        <div id="initial-prompt-screen" class="screen">
            <div class="content initial-prompt-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">You're making good progress on your sleep fitness. Ready to take it to the next level?</p>
                    <p class="message">As your personal sleep coach, the Pod will guide you through the Sleep Sprint Program to improve your sleep efficiency and get you to rest more quickly.</p>

                    <p class="message">The Sleep Sprint Program works by quickly priming your body for sleep using nightly Relaxation Protocol exercises and a calculated Sleep Restriction program that is tailored to your biological sleep needs.</p>

                    <p class="message">Would you like to start the Sleep Sprint Program and take your rest to the next level?</p>
                    <div id="not-right-now-message" class="message" style="display: none; color: #b3b3b3; margin-top: 16px;">
                        No problem, you can start anytime.
                    </div>
                </div>
                <div class="button-group">
                    <button id="yes-program-btn" class="btn btn-primary">Yes, let's do it!</button>
                    <button id="not-right-now-btn" class="btn btn-secondary">Not right now</button>
                </div>
            </div>
        </div>

        <!-- Goals & Guidelines Screen -->
        <div id="goals-guidelines-screen" class="screen">
            <button id="back-goals-btn" class="back-btn" aria-label="Back">Back</button>
            <div class="content">
                <div class="welcome-content">
                    <h1>Sleep Sprint Program Goals</h1>
                    <h2 class="boundary-header">Here's what we can improve with your sleep.</h2>
                    <div class="sleep-metrics-display">
                        <div class="metric-item">
                            <p class="message">Current Sleep Efficiency: <span class="metric-value">72%</span></p>
                            <p class="message">Goal: <span class="goal-value">80-85%</span></p>
                        </div>
                        <div class="metric-item">
                            <p class="message">Current Sleep Onset Latency: <span class="metric-value">35 min</span></p>
                            <p class="message">Goal: <span class="goal-value">15-25 min</span></p>
                        </div>
                    </div>
                    <h2 class="boundary-header">Let's make sure that this Sleep Sprint Program works for your schedule and sleep needs.</h2>
                    <div class="form-group">
                        <label for="earliest-bedtime-input" class="form-label">Earliest Allowable Bedtime:</label>
                        <input type="time" id="earliest-bedtime-input" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label for="latest-wakeup-input" class="form-label">Latest Allowable Wake-Up:</label>
                        <input type="time" id="latest-wakeup-input" class="form-input" />
                    </div>
                    <div id="sleep-duration-error" class="error-message" style="display: none;"></div>
                </div>
                <div class="button-group">
                    <button id="continue-goals-btn" class="btn btn-primary">Continue</button>
                </div>
            </div>
        </div>

        <!-- Sleep Schedule Screen -->
        <div id="sleep-schedule-screen" class="screen">
            <button id="back-schedule-btn" class="back-btn" aria-label="Back">Back</button>
            <div class="content schedule-content">
                <div class="welcome-content">
                    <h1>Your Baseline Sleep Schedule</h1>
                    <p class="message">Based on your sleep performance and preferences, here's your personalized sleep schedule:</p>
                    <div class="schedule-display">
                        <p class="schedule-time" id="calculated-schedule-time">Calculating...</p>
                    </div>
                    <p class="message schedule-explanation">While this might seem like less time spent asleep, it's actually a key step towards higher quality, deeper sleep. This sleep window will automatically adjust based on your sleep performance and biometric data taken each night.<br><br>Your Pod will wake you up using your preference of haptic cues, audio tones, and thermal control.<br><br>Just check in with your Pod for nightly updates.</p>
                </div>
                <div class="button-group">
                    <button id="lock-schedule-btn" class="btn btn-primary">Lock in my sleep schedule</button>
                </div>
            </div>
        </div>

        <!-- Relaxation Training Intro Screen -->
        <div id="relaxation-intro-screen" class="screen">
            <button id="back-relaxation-btn" class="back-btn" aria-label="Back">Back</button>
            <div class="content relaxation-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">Let's quiet the mind. Your Relaxation Protocol starts now.</p>
                    <p class="message">Your Eight Sleep Cover will provide tensing and relaxation cues using the built-in vibration motors and speakers.</p>
                </div>
                <div class="button-group">
                    <button id="start-relaxation-btn" class="btn btn-primary">Start</button>
                </div>
            </div>
        </div>

        <!-- PMR Exercise Screen -->
        <div id="pmr-screen" class="screen">
            <button id="close-btn" class="close-btn" aria-label="Close">×</button>
            <div class="content">
                <h2>Progressive Muscle Relaxation</h2>
                <div id="pmr-instruction" class="pmr-instruction">
                    <p id="instruction-text" class="instruction-text">Get ready...</p>
                    <div id="timer" class="timer"></div>
                </div>
                <div id="progress-indicator" class="progress-indicator">
                    <span id="cycle-count">Cycle 1 of 1</span>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completion-screen" class="screen">
            <div class="content completion-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">That's it!<br><br>Enjoy a restful night of sleep, and see you tomorrow for more sleep training.</p>
                </div>
                <div class="button-group">
                    <button id="advance-night-btn" class="btn btn-primary">Advance to next night</button>
                </div>
            </div>
        </div>

        <!-- Initial Notification Screen -->
        <div id="initial-notification-screen" class="screen active">
            <div class="lockscreen-content">
                <div class="lockscreen-time" id="lockscreen-time">8:13</div>
                <div class="lockscreen-date" id="lockscreen-date">Tuesday, 11 August</div>
                <div class="notification-bubble" id="notification-bubble">
                    <img src="assets/eight_logo.jpg" alt="Eight Sleep" class="notification-logo" />
                    <div class="notification-content">
                        <div class="notification-header">Your New Sleep Plan Is Here</div>
                        <div class="notification-body">Your Pod has designed a custom plan to boost your Sleep Efficiency and help you fall asleep 21% faster. Tap to start your 14-day Sleep Sprint.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nightly Notification Screen -->
        <div id="nightly-notification-screen" class="screen">
            <div class="lockscreen-content">
                <div class="lockscreen-time" id="nightly-lockscreen-time">8:13</div>
                <div class="lockscreen-date" id="nightly-lockscreen-date">Tuesday, 11 August</div>
                <div class="notification-bubble" id="nightly-notification-bubble">
                    <img src="assets/eight_logo.jpg" alt="Eight Sleep" class="notification-logo" />
                    <div class="notification-content">
                        <div class="notification-header">Sleep Coach Checking In</div>
                        <div class="notification-body">You fell asleep 8 minutes faster last night. Let's keep that momentum. Your haptic relaxation starts in 20 minutes.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Good Evening Screen (Nightly Routine) -->
        <div id="good-evening-screen" class="screen">
            <div class="content good-evening-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">Good evening! Welcome back. Let's get you ready for bed.</p>
                    <p class="message">Here's a quick look at your progress towards more restful sleep.</p>
                    <div class="charts-container">
                        <div class="chart-wrapper">
                            <canvas id="se-chart"></canvas>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="sol-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button id="get-ready-btn" class="btn btn-primary">Let's get ready for bed</button>
                </div>
            </div>
        </div>

        <!-- Sleep Window Adjustment Screen (Nightly Routine) -->
        <div id="sleep-window-screen" class="screen">
            <button id="back-window-btn" class="back-btn" aria-label="Back">Back</button>
            <div class="content sleep-window-content">
                <div class="welcome-content">
                    <p class="message">Great work so far. Based on your sleep performance, let's adjust the sleep window to improve your sleep quantity while maintaining sleep quality.</p>
                    <div class="window-adjustment-display">
                        <p class="window-line" id="bedtime-adjustment">
                            <span class="old-time"></span> → <span class="new-time"></span>
                        </p>
                        <p class="window-line" id="wakeup-adjustment">
                            <span class="old-time"></span> → <span class="new-time"></span>
                        </p>
                    </div>
                </div>
                <div class="button-group">
                    <button id="ok-window-btn" class="btn btn-primary">Ok</button>
                </div>
            </div>
        </div>

        <!-- Relaxation Training Info Screen (Nightly Routine) -->
        <div id="relaxation-info-screen" class="screen">
            <button id="back-info-btn" class="back-btn" aria-label="Back">Back</button>
            <div class="content relaxation-info-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">Based on your previous sleep biometric data, we'll tweak your Relaxation Protocol session to optimize tonight's sleep.</p>
                    <p class="message">Your Eight Sleep Cover will provide tensing and relaxation cues using the built-in vibration motors and speakers.</p>
                </div>
                <div class="button-group">
                    <button id="start-nightly-relaxation-btn" class="btn btn-primary">Start</button>
                </div>
            </div>
        </div>

        <!-- Summary Screen -->
        <div id="summary-screen" class="screen">
            <div class="content summary-content">
                <div class="welcome-content">
                    <p class="prompt-main-text">Sleep Sprint Program Summary</p>
                    <p class="message">Congratulations! You've completed your first Sleep Sprint Program and unlocked deeper, more restful sleep.<br><br>By the numbers:</p>
                    <p class="message">Improvement in Sleep Efficiency: <span id="se-improvement" class="metric-value">23%</span></p>
                    <p class="message">Decrease in Sleep Onset Latency: <span id="sol-improvement" class="metric-value">23 min</span></p>
                    <br>
                    <p class="message">Sleep health is a lifelong journey. Keep up the good work.</p>
                </div>
            </div>
        </div>

        <!-- Debug State Toggle (visible on all screens) -->
        <div id="debug-toggle-container" class="debug-toggle-container">
            <button id="debug-initial-notification-btn" class="debug-btn">Initial Notification</button>
            <button id="debug-initial-prompt-btn" class="debug-btn">Initial Prompt</button>
            <button id="debug-nightly-notification-btn" class="debug-btn">Nightly Notification</button>
            <button id="debug-nightly-routine-btn" class="debug-btn">Nightly Routine</button>
            <button id="debug-summary-btn" class="debug-btn">Summary</button>
            <button id="debug-reset-btn" class="debug-btn">Reset</button>
            <button id="day-counter-display" class="debug-btn day-counter-display" disabled>Night 0</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
